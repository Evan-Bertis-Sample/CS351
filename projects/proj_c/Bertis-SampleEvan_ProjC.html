<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Project B</title>

    <!-- CSS -->
    <link rel="stylesheet" href="static/css/base.css" />
    <link rel="stylesheet" href="static/css/footer.css" />

    <!-- Fonts -->
    <!-- <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700&display=swap" rel="stylesheet"> -->

</head>

<body onload="main();">
    <div class="webgl-container">
        <canvas id="webgl">
            Please use a browser that supports "canvas"
        </canvas>
    </div>

    <div class="subtitle-container">
        <b id="camera"> Camera Mode: Follow </b>
        <b id="fps"> FPS: 0 </b>
    </div>

    <div class="modal" id="controls">
        <div class="modal-content">
            <div class="modal-actions-container">
                <h2>Controls</h2>

                <div class="mini-button" onclick="hideModal()">
                    <span class="close">&times;</span>
                </div>
            </div>

            <h4>General</h4>
            <ul>
                <li>WASD to move</li>
                <li>Space to Switch Camera Modes (only used in the left viewport) </li>
            </ul>

            <h4>Camera Modes (left viewport) </h4>

            <ul>
                <li>Follow: Camera follows the player. It is fixed to a preset rotation</li>
                <li>Free: Camera moves independent of the player</li>
                <ul>
                    <li>WASD to move forward, left, back, right</li>
                    <li>Q and E to move up and down</li>
                    <li>Mouse Drag to look around</li>
                </ul>
            </ul>

            <h4>Camera Controls (right viewport)</h4>

            <ul>
                <li>Mouse Drag to rotate camera about origin</li>
            </ul>

            <h4>Interactions</h4>
            <ul>
                <li>When in follow camera mode, mouse drag on the left viewport to move the crystals around</li>
            </ul>
        </div>
    </div>

    <div class="body-container">
        <div>
            <h1>Project C: Better Lighting and Materials</h1>
            <h3>Evan Bertis-Sample</h3>
            
            <div class="col-container">
                <div>
                    <button onclick="showModal()">
                        Controls
                    </button>

                    <button onclick="invertLightingSetting()">
                        Toggle Lighting
                    </button>

                    <!-- Dropdown for choosing lighting type -->
                    <select id="lighting-type" onchange="changeLightingType()">
                        <option value="phong">Phong</option>
                        <option value="test">Test</option>
                    </select>

                </div>

                <div>
                    <!-- Vector 3 Input for position of light -->
                    <!-- 3 floating point fields with sliders -->
                    <div class="vector-container">
                        <label for="light-position-x">X</label>
                        <input type="range" id="light-position-x" min="-25" max="25" value="0" step="0.1" oninput="changeLightPosition()">
                        <input type="number" id="light-position-x-number" value="0" step="0.1" oninput="changeLightPosition()">

                        <label for="light-position-y">Y</label>
                        <input type="range" id="light-position-y" min="-25" max="25" value="0" step="0.1" oninput="changeLightPosition()">
                        <input type="number" id="light-position-y-number" value="0" step="0.1" oninput="changeLightPosition()">

                        <label for="light-position-z">Z</label>
                        <input type="range" id="light-position-z" min="-25" max="25" value="0" step="0.1" oninput="changeLightPosition()">
                        <input type="number" id="light-position-z-number" value="0" step="0.1" oninput="changeLightPosition()">

                        <button value="Reset" onclick="resetLightPosition()">Reset</button>
                    </div>

                    <div class="vector-container">
                        <!-- light intensity -->
                        <label for="light-intensity">Intensity</label>
                        <input type="range" id="light-intensity" min="0" max="10" value="10" step="0.1" oninput="changeLightIntensity()">
                        <input type="number" id="light-intensity-number" value="10" step="0.1" oninput="changeLightIntensity()">

                        <!-- active or not -->
                        <label for="light-active">Active</label>
                        <input type="checkbox" id="light-active" checked="true" onclick="setLightStatus()">
                    </div>

                    <div class="vector-container">
                        <!-- light color -->
                        <label>R</label>
                        <input type="range" id="light-color-r" min="0" max="1" value="1" step="0.1" oninput="setLightColor()">

                        <label>G</label>
                        <input type="range" id="light-color-g" min="0" max="1" value="1" step="0.1" oninput="setLightColor()">

                        <label>B</label>
                        <input type="range" id="light-color-b" min="0" max="1" value="1" step="0.1" oninput="setLightColor()">

                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="lib/webgl-utils.js"></script>
    <script src="lib/webgl-debug.js"></script>
    <script src="lib/cuon-utils.js"></script>
    <script src="lib/cuon-matrix-quat03.js"></script>

    <!-- Static Files/File Loading-->
    <script src="engine/static.js"></script>
    <script src="engine/file.js"></script>

    <!-- Modules -->
    <script src="engine/material.js"></script>
    <script src="engine/mesh.js"></script>
    <script src="engine/scene_graph.js"></script>
    <script src="engine/scene.js"></script>
    <script src="engine/input.js"></script>
    <script src="engine/ecs.js"></script>
    <script src="engine/lighting.js"></script>
    <script src="engine/config.js"></script>

    <!-- Entry point, defer it-->
    <script src="Bertis-SampleEvan_ProjC.js" defer></script>

    <!-- Controls points-->
    <script>
        function invertLightingSetting() {
            console.log("Toggling lighting");
            if (c_ENABLE_LIGHTING == 1.0) {
                c_ENABLE_LIGHTING = 0.0;
            }
            else {
                c_ENABLE_LIGHTING = 1.0;
            }

            g_materialRegistry.setGlobalParam("u_enable_lighting", c_ENABLE_LIGHTING);
        }

        function showModal() {
            var modal = document.getElementById("controls");
            modal.style.display = "block";
        }

        function hideModal() {
            var modal = document.getElementById("controls");
            modal.style.display = "none";
        }

        function changeLightPosition()
        {
            var x = document.getElementById("light-position-x").value;
            var y = document.getElementById("light-position-y").value;
            var z = document.getElementById("light-position-z").value;

            document.getElementById("light-position-x-number").value = x;
            document.getElementById("light-position-y-number").value = y;
            document.getElementById("light-position-z-number").value = z;

            let position = new Vector3([x, z, -y]);
            let light = g_lightRegistry.getLight(0)

            light.position = position;
        }

        function resetLightPosition()
        {
            document.getElementById("light-position-x").value = 0;
            document.getElementById("light-position-y").value = 0;
            document.getElementById("light-position-z").value = 0;

            document.getElementById("light-position-x-number").value = 0;
            document.getElementById("light-position-y-number").value = 0;
            document.getElementById("light-position-z-number").value = 0;

            let position = new Vector3([0, 0, 0]);
            let light = g_lightRegistry.getLight(0)

            light.position = position;
        }

        function changeLightIntensity()
        {
            var intensity = document.getElementById("light-intensity").value;
            document.getElementById("light-intensity-number").value = intensity;

            let light = g_lightRegistry.getLight(0)
            light.intensity = intensity;
        }

        function setLightStatus()
        {
            let light = g_lightRegistry.getLight(0)
            light.active = !light.active;
        }

        function setLightColor()
        {
            let r = document.getElementById("light-color-r").value;
            let g = document.getElementById("light-color-g").value;
            let b = document.getElementById("light-color-b").value;

            let light = g_lightRegistry.getLight(0)

            light.color = new Vector3([r, g, b]);

        }

        function setupLightingControls()
        {
            let position = g_lightRegistry.getLight(0).position;
            position = new Vector3([position.elements[0], -position.elements[2], position.elements[1]]);

            document.getElementById("light-position-x").value = position.elements[0];
            document.getElementById("light-position-y").value = position.elements[1];
            document.getElementById("light-position-z").value = position.elements[2];

            document.getElementById("light-position-x-number").value = position.elements[0];
            document.getElementById("light-position-y-number").value = position.elements[1];
            document.getElementById("light-position-z-number").value = position.elements[2];


            document.getElementById("light-intensity").value = g_lightRegistry.getLight(0).intensity;
            document.getElementById("light-intensity-number").value = g_lightRegistry.getLight(0).intensity;

            document.getElementById("light-active").checked = g_lightRegistry.getLight(0).active;

            let color = g_lightRegistry.getLight(0).color;
            document.getElementById("light-color-r").value = color.elements[0];
            document.getElementById("light-color-g").value = color.elements[1];
            document.getElementById("light-color-b").value = color.elements[2];
        }

        async function changeLightingType() {
            var e = document.getElementById("lighting-type");
            var value = e.options[e.selectedIndex].value;
            console.log("Changing lighting type to: " + value);
            await g_materialRegistry.setGlobalShader(value)
        }

        // add a listener for when the user clicks outside of the modal
        window.onclick = function (event) {
            var modal = document.getElementById("controls");
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

    </script>
    </div>
</body>

</html>